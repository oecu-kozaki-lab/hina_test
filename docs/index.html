import React, { useState, useEffect } from 'react';

const KanjiClassifier = () => {
  const [allData, setAllData] = useState([]);
  const [groupA, setGroupA] = useState([]);
  const [groupB, setGroupB] = useState([]);
  const [criteria, setCriteria] = useState('nature');

  // 分類基準のキーワード
  const keywords = {
    nature: ['やま', 'さん', 'かわ', 'せん', 'き', 'もく', 'はな', 'か', 'みず', 'すい', 'いわ', 'たに', 'うみ', 'かい'],
    color: ['しろ', 'はく', 'あか', 'しゅ', 'あお', 'せい', 'き', 'くろ', 'こく', 'みどり', 'りょく', 'いろ'],
    animal: ['いぬ', 'けん', 'ねこ', 'とら', 'うま', 'うし', 'さる', 'とり', 'むし', 'さかな', 'ぎょ'],
    body: ['て', 'しゅ', 'あし', 'そく', 'め', 'もく', 'みみ', 'じ', 'はな', 'び', 'くち', 'こう', 'あたま', 'とう']
  };

  useEffect(() => {
    loadFiles();
  }, []);

  useEffect(() => {
    classify();
  }, [criteria, allData]);

  const loadFiles = async () => {
    const files = ['自然.txt', '色.txt', '身体.txt', '動物.txt'];
    const data = [];

    for (const file of files) {
      try {
        const content = await window.fs.readFile(file, { encoding: 'utf8' });
        const lines = content.split('\n').filter(line => line.trim() && !line.startsWith('漢字'));
        
        lines.forEach(line => {
          const [kanji, reading] = line.split(',');
          if (kanji && reading) {
            data.push({ kanji: kanji.trim(), reading: reading.trim() });
          }
        });
      } catch (error) {
        console.error(`${file}読み込みエラー:`, error);
      }
    }
    setAllData(data);
  };

  const classify = () => {
    const a = [];
    const b = [];
    const currentKeywords = keywords[criteria];

    allData.forEach(item => {
      const hasKeyword = currentKeywords.some(kw => item.reading.includes(kw));
      if (hasKeyword) {
        a.push(item);
      } else {
        b.push(item);
      }
    });

    setGroupA(a);
    setGroupB(b);
  };

  const criteriaNames = {
    nature: '自然要素',
    color: '色',
    animal: '動物',
    body: '体の部位'
  };

  return (
    <div className="p-8 bg-gray-50 min-h-screen">
      <h1 className="text-3xl font-bold text-center mb-8">漢字読み分類プログラム</h1>

      {/* 分類基準選択 */}
      <div className="bg-white rounded-lg shadow p-6 mb-6 max-w-4xl mx-auto">
        <h2 className="font-bold mb-4">分類基準を選択:</h2>
        <div className="flex gap-4">
          {Object.keys(keywords).map(key => (
            <button
              key={key}
              onClick={() => setCriteria(key)}
              className={`px-6 py-3 rounded font-semibold ${
                criteria === key
                  ? 'bg-blue-500 text-white'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              {criteriaNames[key]}
            </button>
          ))}
        </div>
      </div>

      {/* 統計 */}
      <div className="max-w-4xl mx-auto mb-6 grid grid-cols-3 gap-4">
        <div className="bg-white rounded-lg shadow p-4 text-center">
          <p className="text-gray-600 text-sm">総データ数</p>
          <p className="text-3xl font-bold">{allData.length}</p>
        </div>
        <div className="bg-green-50 rounded-lg shadow p-4 text-center">
          <p className="text-green-700 text-sm font-semibold">A群（含む）</p>
          <p className="text-3xl font-bold text-green-600">{groupA.length}</p>
        </div>
        <div className="bg-blue-50 rounded-lg shadow p-4 text-center">
          <p className="text-blue-700 text-sm font-semibold">B群（含まない）</p>
          <p className="text-3xl font-bold text-blue-600">{groupB.length}</p>
        </div>
      </div>

      {/* 分類結果 */}
      <div className="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* A群 */}
        <div className="bg-white rounded-lg shadow">
          <div className="bg-green-500 text-white p-4 rounded-t-lg">
            <h3 className="text-xl font-bold">A群: {criteriaNames[criteria]}を含む</h3>
          </div>
          <div className="p-4 max-h-96 overflow-y-auto">
            <table className="w-full">
              <thead className="bg-gray-100">
                <tr>
                  <th className="p-2 text-left">漢字</th>
                  <th className="p-2 text-left">読み</th>
                </tr>
              </thead>
              <tbody>
                {groupA.map((item, i) => (
                  <tr key={i} className="border-b hover:bg-green-50">
                    <td className="p-2 font-medium">{item.kanji}</td>
                    <td className="p-2 text-gray-600">{item.reading}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>

        {/* B群 */}
        <div className="bg-white rounded-lg shadow">
          <div className="bg-blue-500 text-white p-4 rounded-t-lg">
            <h3 className="text-xl font-bold">B群: {criteriaNames[criteria]}を含まない</h3>
          </div>
          <div className="p-4 max-h-96 overflow-y-auto">
            <table className="w-full">
              <thead className="bg-gray-100">
                <tr>
                  <th className="p-2 text-left">漢字</th>
                  <th className="p-2 text-left">読み</th>
                </tr>
              </thead>
              <tbody>
                {groupB.map((item, i) => (
                  <tr key={i} className="border-b hover:bg-blue-50">
                    <td className="p-2 font-medium">{item.kanji}</td>
                    <td className="p-2 text-gray-600">{item.reading}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  );
};

export default KanjiClassifier;
